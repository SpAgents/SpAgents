# axSpA 系统压力测试脚本

本项目提供了两个压力测试脚本，用于测试 axSpA 智能诊断系统的性能和并发处理能力。

## 📁 文件说明

### 1. `stress_test.py` - 完整版压力测试脚本
- **功能**：全面的压力测试，包括所有API接口
- **特点**：
  - 多线程并发测试
  - 完整的用户工作负载模拟
  - 详细的性能统计和报告
  - 支持长时间测试
  - 生成JSON格式的详细报告

### 2. `quick_stress_test.py` - 快速压力测试脚本
- **功能**：快速性能测试，适合日常使用
- **特点**：
  - 简化的测试流程
  - 快速结果反馈
  - 控制台实时输出
  - 适合开发调试

## 🚀 快速开始

### 安装依赖

```bash
pip install requests numpy
```

### 运行快速测试

```bash
# 使用默认参数（5个并发用户）
python quick_stress_test.py

# 指定并发用户数
python quick_stress_test.py --users 10

# 指定目标URL
python quick_stress_test.py --users 5 --url http://localhost:5500
```

### 运行完整测试

```bash
# 使用默认参数
python stress_test.py

# 自定义测试参数
python stress_test.py --users 20 --duration 120 --think-time 2

# 跳过某些测试
python stress_test.py --no-upload --no-analyze
```

## 📊 测试接口

### 1. 登录接口 (`/login`)
- **方法**：POST
- **功能**：管理员身份验证
- **测试内容**：登录成功率和响应时间

### 2. 文件上传接口 (`/upload`)
- **方法**：POST
- **功能**：上传NPY格式的MRI数据
- **测试内容**：文件上传成功率和传输速度

### 3. 批量上传接口 (`/upload_batch`)
- **方法**：POST
- **功能**：批量上传多个文件
- **测试内容**：批量处理能力和并发性能

### 4. 分析接口 (`/analyze/<file_id>`)
- **方法**：GET
- **功能**：AI诊断分析（流式响应）
- **测试内容**：AI推理性能和稳定性

### 5. 跳过分析接口 (`/analyze/skip`)
- **方法**：GET
- **功能**：基于表单数据的快速诊断
- **测试内容**：轻量级分析性能

## ⚙️ 配置参数

### 快速测试参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `--users` | 5 | 并发用户数 |
| `--url` | http://152.136.58.167:5500 | 目标服务器URL |

### 完整测试参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `--users` | 10 | 并发用户数 |
| `--duration` | 60 | 测试时长（秒） |
| `--think-time` | 1.0 | 用户思考时间（秒） |
| `--no-upload` | False | 跳过文件上传测试 |
| `--no-analyze` | False | 跳过分析测试 |
| `--url` | http://152.136.58.167:5500 | 目标服务器URL |

## 📈 测试报告

### 快速测试报告
- 实时控制台输出
- 各接口的成功率和响应时间
- 总体性能统计

### 完整测试报告
- 详细的JSON格式报告
- 分接口的性能统计
- P95、P99响应时间
- 每秒请求数（RPS）
- 成功率分析

## 🔧 测试数据

### 模拟MRI数据
- **格式**：NPY文件
- **尺寸**：24×512×512（完整版）或 24×128×128（快速版）
- **内容**：随机生成的模拟MRI数据
- **特点**：包含结构化模式和噪声，模拟真实MRI特征

### 模拟表单数据
- **年龄**：20-70岁随机
- **性别**：男/女随机
- **检查结果**：随机生成
- **病史信息**：模拟真实病历数据

## 📋 使用建议

### 开发阶段
```bash
# 快速验证功能
python quick_stress_test.py --users 3
```

### 性能调优
```bash
# 逐步增加负载
python stress_test.py --users 5 --duration 30
python stress_test.py --users 10 --duration 60
python stress_test.py --users 20 --duration 120
```

### 生产环境测试
```bash
# 模拟真实负载
python stress_test.py --users 50 --duration 300 --think-time 2
```

## ⚠️ 注意事项

1. **服务器资源**：确保目标服务器有足够的资源处理并发请求
2. **网络带宽**：大量文件上传可能消耗较多带宽
3. **存储空间**：测试会生成临时文件，注意清理
4. **AI模型负载**：分析接口会调用AI模型，注意GPU/CPU使用率
5. **数据库压力**：大量并发可能对数据库造成压力

## 🐛 故障排除

### 常见问题

1. **连接超时**
   ```bash
   # 检查网络连接
   ping 152.136.58.167
   
   # 检查服务状态
   curl http://152.136.58.167:5500
   ```

2. **登录失败**
   - 确认管理员账号密码正确
   - 检查服务器是否在维护模式

3. **上传失败**
   - 检查文件大小限制
   - 确认文件格式正确
   - 检查磁盘空间

4. **分析超时**
   - 检查AI模型服务状态
   - 调整超时时间参数
   - 监控服务器资源使用

### 日志文件
- `stress_test.log`：详细测试日志
- `stress_test_report_YYYYMMDD_HHMMSS.json`：测试报告

## 📞 技术支持

如有问题，请检查：
1. 网络连接状态
2. 服务器服务状态
3. 日志文件中的错误信息
4. 系统资源使用情况 